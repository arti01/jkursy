<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/templates/templatetrag.xhtml"
                xmlns:a4j="http://richfaces.org/a4j">

    <ui:define name="content">
        <h:form>
            <h:panelGroup id="naglowek">
                <h3>Data Kursu: #{tragKursyAc.kurs.dataKursu}, Wartość: #{tragKursyAc.kurs.suma}, Suma wpłat: #{tragKursyAc.kurs.sumaWplat}</h3>
                <a4j:commandButton value="zestawienie" action="#{tragKursyAc.kursZestawienie}" immediate="true"/>
            </h:panelGroup>
        </h:form>
        <div id="contentLewy">
            <div id="tabela">
                <h:form >
                    <h:panelGroup id="formMenu">
                        <rich:dataTable value="#{tragKursyAc.zf.zamPoczatkowe}" var="zam" id="tabelaMenu">
                            <f:facet name="header">
                                Dostępne zamówienia
                            </f:facet> 
                            <rich:column >
                                <f:facet name="header">
                                    data zamówienia
                                </f:facet> 
                                <h:outputText value="#{zam.dataZamowienia}" id="dataZam"/>
                                <rich:tooltip id="tt1" layout="block" target="dataZam">
                                    <a4j:repeat value="#{zam.potrawy}" var="potrawa">
                                        <h:outputText value="#{potrawa.nazwa}" /><br/>
                                    </a4j:repeat>
                                </rich:tooltip>
                            </rich:column >
                            <rich:column >
                                <f:facet name="header">
                                    Żarłacz
                                </f:facet> 
                                <h:outputText value="#{zam.uzytkownik.imieNazwisko}"/>
                            </rich:column >
                            <rich:column >
                                <f:facet name="header">
                                    <h:outputText value="wartość"/>
                                </f:facet> 
                                <h:outputText value="#{zam.suma}"/>
                            </rich:column >
                            <rich:column >
                                <a4j:commandLink value="Przyjmij" action="#{tragKursyAc.przyjmij}" render="formMenu, formZam, naglowek">
                                    <f:setPropertyActionListener value="#{zam}" target="#{tragKursyAc.zam}"/>
                                </a4j:commandLink>
                            </rich:column >
                        </rich:dataTable>
                    </h:panelGroup>
                </h:form>
            </div>
        </div>

        <div id="contentPrawy">
            <div id="tabela">
                <h:form >
                    <h:panelGroup id="formZam">
                        <rich:dataTable value="#{tragKursyAc.kurs.zamowienia}" var="zam" id="tabelaZam">
                            <f:facet name="header">
                                Przyjęte zamówienia
                            </f:facet> 
                            <rich:column >
                                <f:facet name="header">
                                    data zamówienia
                                </f:facet> 
                                <h:outputText value="#{zam.dataZamowienia}" id="dataZam"/>
                                <rich:tooltip id="tt1" layout="block" target="dataZam">
                                    <a4j:repeat value="#{zam.potrawy}" var="potrawa">
                                        <h:outputText value="#{potrawa.nazwa}" /><br/>
                                    </a4j:repeat>
                                </rich:tooltip>
                                <br/>
                                <h:outputText value="#{zam.statusZamowienia}"/>
                            </rich:column >
                            <rich:column >
                                <f:facet name="header">
                                    Żarłacz
                                </f:facet> 
                                <h:outputText value="#{zam.uzytkownik.imieNazwisko}"/>
                            </rich:column >
                            <rich:column >
                                <f:facet name="header">
                                    <h:outputText value="wartość"/>
                                </f:facet> 
                                <h:outputText value="#{zam.suma}"/>
                                <h:commandLink value=" historia transakcji" action="#{tragKursyAc.transHist}">
                                    <f:setPropertyActionListener value="#{zam}" target="#{tragKursyAc.zam}"/>
                                </h:commandLink>
                            </rich:column >
                            
                            <rich:column>
                                <f:facet name="header">
                                    <h:outputText value="saldo (ujemne oznacza, że tragarz przyjął gotówkę a nie kupił obiadu)"/>
                                </f:facet> 
                                <h:outputText value="#{zam.saldo}"/>
                            </rich:column>

                            <rich:column >
                                <f:facet name="header">
                                    <h:outputText value="przyjmij wpłatę"/>
                                </f:facet> 
                                <a4j:commandLink id="zmienWpl">
                                    <f:setPropertyActionListener value="#{zam}" target="#{tragKursyAc.zam}"/>
                                    <h:inputText value="#{tragKursyAc.zero}" valueChangeListener="#{tragKursyAc.przyjmijWplate}" size="6" >
                                        <a4j:ajax render="formZam" execute="zmienWpl" event="blur" />
                                        <f:convertNumber pattern="#,###,##0.00"/>
                                    </h:inputText>
                                </a4j:commandLink>
                            </rich:column >

                            <rich:column >
                                <a4j:commandLink value="Wycofaj zamówienie" action="#{tragKursyAc.wycofaj}" render="formMenu, formZam, naglowek">
                                    <f:setPropertyActionListener value="#{zam}" target="#{tragKursyAc.zam}"/>
                                </a4j:commandLink>
                            </rich:column >
                        </rich:dataTable>
                    </h:panelGroup>
                </h:form>
            </div>
        </div>
    </ui:define>

</ui:composition>
